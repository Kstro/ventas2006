{% extends 'hnrsircimBundle::Layout.html.twig' %}



{% block lista_modulos %}
    {% for modulo in modulos %}
        <li><a href="{{ path(modulo.osUrl, { 'login': usuario.usLogin }) }}">{{modulo}}</a></li>
    {% endfor %}
{% endblock %}




{% block nombre_usr %}
    <label id="{{ usuario.usLogin }}">
        {{ usuario.usLogin }}
    </label> 
{% endblock %} 

{% block mod_activo %} 
    
    Administración

{% endblock %}  

{% block javascripts %}
    {{parent()}}
    
    
    <script src="{{ asset('bundles/hnrsircim/css/alertify/lib/alertify.min.js') }}" type="text/javascript"></script>    
    
{% endblock %}

{% block botones_modulo %}
    <div class="menu_grupo">
        {# <button id="buscar" class="btn btn_destacado"></button> #}
        <button href="{{ path('estudioarea_new') }}" id="nuevo" class="btn btn_destacado"></button>

    </div>
{% endblock %}

{% block emergente %}
    <div id="deshabilitar"></div>
    <div id="popup_box_estudioarea"></div>
{% endblock %}
{% block body -%}
    <br><br>
    <table class="listados">
        <thead>
            <tr>
                <th>No.</th>
                <th>Nombre</th>
                <th>Área</th>
                <th>Tipo</th>
                <th>Activo/Inactivo</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for key, entity in entities %}
            <tr>
                <td>{{key+1}}</td>
                <td>{{ entity.idEstudio.esNombre }}</td>
                <td>{{ entity.idArea.arNombre }}</td>
                <td>{{ entity.idEstudio.esTipo }}</td>
                <td>
                    <div class="slideThree">   
                            <input type="checkbox" 
                                
                                    {% if entity.estadoEstudioArea == 1%} 
                                        checked 
                                    {% endif %} 
                                
                                    id="{{entity.id}}" name="{{entity.idEstudio.esNombre}}" 
                            />
                            <label for="{{entity.id}}"></label>
                        </div>
                    

                </td>
                <td>
                    <a class="acciones" href="{{ path('estudioarea_edit', { 'id': entity.id,'login':login }) }}">
                        <img src="{{ asset('bundles/hnrsircim/img/edit.png')}}">
                    </a>
                    <a class="acciones" href="{{ path('estudioarea_show', { 'id': entity.id, 'login':login }) }}">
                        <img src="{{ asset('bundles/hnrsircim/img/detalle.png')}}">
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

        
    {% endblock %}


    {% block script %}

    <script type="text/javascript">

        jQuery(document).ready(function($) {

            $('.sign_out a').click(function(event) {
                var login = $('#nombre_usr label').attr('id');;
                // alert(Routing.generate('logout', { login: login }));
                $.getJSON(Routing.generate('logout', { login: login }), function(data) { 
                
                }); 
                        

            });


            $('#nuevo, .acciones').click(function(){
        
            //Recuperar el atributo href del enlace actual
            var href = $(this).attr('href');
            
            // crear un elemento para colocar la información
            
            $('#popup_box_estudioarea').fadeIn('fast');
            $('#popup_box_estudioarea').html('<div id="cargando"><img src={{ asset('bundles/hnrsircim/img/loading.gif') }}><div>');
            
            $('#deshabilitar').fadeIn('slow');
            // cargar mediante una llamada ajax la dirección que tiene href dentro de resultado 
            $('#popup_box_estudioarea').load(href);
             
            // Para que no haga el comportamiento normal del enlace y cargue la página
            return false;

        });

  

            
            $('.slideThree input').click(function(event) {
                var estado = !$(this).is(':checked');
                var nombre = $(this).attr('name');
                var id = $(this).attr('id');
                // confirm dialog
                $('#deshabilitar').fadeIn('fast');
                alertify.confirm("<div class='icon_msg confirm_icon'><img src={{ asset('bundles/hnrsircim/img/confirm.png') }}></div><div class=\"msg confirm_msg\">¿Desea cambiar el estado de '"+nombre+"'?</div>", function (e) {

                    if (e) {
                        // user clicked "ok"
                        var activo= $('#'+id).is(':checked');
                        
                        if (activo){
                            activo=1;
                        }
                        else{
                            activo=0;
                        }
                        
                        var login = $('#nombre_usr label').attr('id');
                        $.getJSON(Routing.generate('estudioarea_update_estados', { id: id, activo: activo, login:login}), function(data) { 
                        }); 
                        alertify.success("<div class='icon_msg'><img src={{ asset('bundles/hnrsircim/img/info.png') }}></div><div class=\"msg\">Estado de '"+nombre+"' modificado con éxito</div>");
                        
                    } else {
                        // user clicked "cancel"
                        $('.slideThree input[id='+id+']').prop('checked', estado);
                        alertify.log("<div class='icon_msg'><img src={{ asset('bundles/hnrsircim/img/info.png') }}></div><div class=\"msg\">Acción cancelada</div>");
                    }
                    $('#deshabilitar').fadeOut('fast');
                });

            }); 

            

        });

    </script>

    {% endblock %}
